<?php/*** some utiliities**/class SforumUtils {	public static function time() {		return time();	}		public static function displayDateTime($timestamp) {		return date('F j, Y, g:i a', $timestamp);	}		public static function post( $text ) {		$text = nl2br(CHtml::encode($text), true);				$text = preg_replace ("/[\n\r]+/", "", $text);		$text = str_ireplace(array('[code]', '[/code]'), array('<pre class="code">', '</pre>'), $text);				$text = preg_replace("/\[(\/?((b)|(u)|(i)|(p)|(li)|(ul)|(h1)|(h2)|(h3)|(h4)|(h5)|(h6)|(code)))\]/iU", "<$1>", $text);								return $text;	}		public static function showFlash() {		if( Yii::app()->user->hasFlash('success') ) {			$flash = Yii::app()->user->getFlash('success');			return '<div id="success-flash" class="flash-success">			' . $flash . '			</div><script>fadeAway(\'success-flash\');</script>';		}				return null;	}		public static function getMailer() {		$path = Yii::getPathOfAlias('application.extensions.mailer.EMailer') . '.php';				if( file_exists($path) ) {			$mailer = Yii::createComponent('application.extensions.mailer.EMailer');						//$mailer->Host = <your smtp host>;			//$mailer->IsSMTP();						$adminEmail = isset(Yii::app()->params['adminEmail'])?Yii::app()->params['adminEmail']:null;						if( $adminEmail ) {				$mailer->From = $adminEmail;				$mailer->AddReplyTo($adminEmail);				$mailer->AddBCC($adminEmail);			}			$mailer->FromName = Yii::app()->name;						$mailer->CharSet = 'UTF-8';			//$mailer->Subject = Yii::t('demo', 'Yii rulez!');			//$mailer->Body = $message;			//$mailer->Send();						return $mailer;		}				return null;	}		public static function sendMail($to, $subject, $body) {		$mailer = self::getMailer();		if(!$mailer) return false;				if( is_array($to) ) {			foreach( $to as $email ) {				$mailer->AddAddress( $email );			}		}		else {			$mailer->AddAddress( $to );		}				$mailer->Subject = CHtml::encode($subject);		$mailer->Body = CHtml::encode($body);		return $mailer->Send();	}		public static function isAdmin() {		return Yii::app()->user->isAdmin;	}		public static function confirmDelete($url, $name, $id, $retUrl=null, $button='Delete') {		$form = array('<form action="' . $url . '" method="POST" class="inlineform" style="width: 60px;">');		$form[] = '<input type="hidden" name="id" value="' . $id . '"/>';				if($retUrl) $form[] = '<input type="hidden" name="retUrl" value="' . $retUrl . '"/>';				$form[] = '<input type="submit" onclick="return ConfirmDelete(\'Are you sure you want to delete ' . CHtml::encode($name) . '\');" value=" ' . $button . ' " />';				$form[] = '</form>';				return implode("\n", $form);	}		public static function textArea($model, $field, $htmlOptions=array() ) {		$html = '';				$html .= '<div>		<input type="button" value="B" incode="b" class="bibtn" title="Bold" /> 		<input type="button" value="I" incode="i" class="bibtn" title="Italic" /> 		<input type="button" value="U" incode="u" class="bibtn" title="Underline" /> 		<input type="button" value="P" incode="p" class="bibtn" title="Paragraph" /> 		<input type="button" value="H1" incode="h1" class="bibtn" title="Heading-1" /> 		<input type="button" value="H2" incode="h2" class="bibtn" title="Heading-2" /> 		<input type="button" value="Code" incode="code" class="bibtn" title="Code" /> 		<input type="button" value="UL" incode="ul" class="bibtn" title="List" /> 		<input type="button" value="LI" incode="li" class="bibtn" title="List Item" /> 		</div>';				$html .= CHtml::activeTextArea($model, $field, $htmlOptions);		$fieldid = get_class($model)  . '_' . $field;				$html .= <<<EOQ		<script>		\$('.bibtn').click(function() {			var tag = $(this).attr('incode');			var len = tag.length;			var text = '['+tag+'][/'+tag+']'; 			var texta = document.getElementById('$fieldid');						//The new position for the cursor after adding the bbcode			var caret_pos = getCaretPosition(texta).start;			var new_pos = caret_pos + len + 2;						\$('#$fieldid').insertAtCaret(text);			// Center the cursor when we don't have a selection			// Gecko and proper browsers			if (!isNaN(texta.selectionStart))			{				texta.selectionStart = new_pos;				texta.selectionEnd = new_pos;			}				// IE			else if (document.selection)			{				var range = texta.createTextRange(); 				range.move("character", new_pos); 				range.select();				storeCaret(texta);			}			texta.focus();		});		</script>EOQ;		return $html;	}}